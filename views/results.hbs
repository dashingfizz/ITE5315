{{> header}}

<div class="container">
    <!-- Search Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="main-container">
                <div class="card custom-card">
                    <div class="card-header card-header-custom">
                        <h2 class="mb-0">Restaurant Search Results</h2>
                    </div>
                    <div class="card-body">
                        {{#if success}}
                            <div class="alert alert-success alert-custom">
                                <strong>üéâ Success!</strong> {{success}}
                            </div>
                        {{/if}}
                        {{#if error}}
                            <div class="alert alert-danger alert-custom">
                                <strong>‚ö†Ô∏è Error:</strong> {{error}}
                            </div>
                        {{/if}}
                        {{#if message}}
                            <div class="alert alert-info alert-custom">
                                <strong>‚ÑπÔ∏è Info:</strong> {{message}}
                            </div>
                        {{/if}}
                        
                        <div class="search-summary">
                            {{#if league}}<strong>League:</strong> {{league}} |{{/if}}
                            {{#if team}}<strong>Team:</strong> {{team}} |{{/if}}
                            {{#if stadium}}<strong>Stadium:</strong> {{stadium}}{{/if}}
                            {{#if city}} | <strong>Location:</strong> {{city}}, {{state}}{{/if}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Search Functions -->
    <div class="row mb-4">

        <!-- Results Count and Search -->
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h2 class="results-count">
                    Found {{searchCount}} Restaurant{{#if (gt searchCount 1)}}s{{/if}}
                </h2>
                <a href="/" class="btn btn-outline-custom">
                    üîç New Search
                </a>
            </div>
        </div>

        <form method="GET" class="row g-3 mb-4">
                <input type="hidden" name="limit" value="{{limit}}">
                
                <!-- Preserve search context -->
                <input type="hidden" name="league" value="{{league}}">
                <input type="hidden" name="team" value="{{team}}">
                <input type="hidden" name="stadium" value="{{stadium}}">
                <input type="hidden" name="page" value="1">
                <input type="hidden" name="limit" value="{{limit}}">
                
                <!-- Sort -->
                <div class="col-md-4">
                    <label class="form-label fw-bold">Sort By</label>
                    <select name="sort" class="form-select">
                        <option value="">Default</option>
                        <option value="rating_desc" {{#if (eq selectedSort "rating_desc")}}selected{{/if}}>Rating (High ‚Üí Low)</option>
                        <option value="rating_asc" {{#if (eq selectedSort "rating_asc")}}selected{{/if}}>Rating (Low ‚Üí High)</option>
                        <option value="reviews_desc" {{#if (eq selectedSort "reviews_desc")}}selected{{/if}}>Reviews (Most ‚Üí Least)</option>
                        <option value="reviews_asc" {{#if (eq selectedSort "reviews_asc")}}selected{{/if}}>Reviews (Least ‚Üí Most)</option>
                        <option value="distance_asc" {{#if (eq selectedSort "distance_asc")}}selected{{/if}}>Distance (Closest)</option>
                    </select>
                </div>
                
                <!-- Filter -->
                <div class="col-md-4">
                    <label class="form-label fw-bold">Filter by Category</label>
                    <select name="category" class="form-select">
                        <option value="">All Categories</option>
                        {{#each categories}}
                            <option value="{{this}}" {{#if (eq ../selectedCategory this)}}selected{{/if}}>
                            {{this}}
                        </option>
                        {{/each}}
                    </select>
                </div>
                
                <div class="col-md-3 d-flex align-items-end">
                    <button class="btn btn-primary w-100">Apply</button>
                </div>
        </form>
    
    </div>


    <!-- Restaurant Cards -->
    <div class="row">
        {{#each restaurants}}
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card restaurant-card h-100">
                {{#if image_url}}
                <img src="{{image_url}}" class="card-img-top" alt="{{name}}" style="height: 200px; object-fit: cover;">
                {{else}}
                <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                    <span class="text-muted">No Image Available</span>
                </div>
                {{/if}}
                
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">{{name}}</h5>
                    
                    <!-- Rating and Price -->
                    <div class="mb-2">
                        <span class="badge badge-rating me-1">
                            ‚≠ê {{rating}} ({{review_count}} reviews)
                        </span>
                        {{#if price}}
                        <span class="badge badge-custom">{{price}}</span>
                        {{/if}}
                    </div>
                    
                    <!-- Categories -->
                    <div class="mb-2">
                        {{#each categories}}
                        <span class="badge bg-secondary me-1 mb-1">{{title}}</span>
                        {{/each}}
                    </div>
                    
                    <!-- Address -->
                    {{#if location.display_address}}
                    <p class="card-text small text-muted mb-2">
                        üìç {{#each location.display_address}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}
                    </p>
                    {{/if}}
                    
                    <!-- Phone -->
                    {{#if display_phone}}
                    <p class="card-text small mb-2">
                        üìû {{display_phone}}
                    </p>
                    {{/if}}
                    
                    <!-- Distance -->
                    {{#if distance}}
                    <p class="card-text small mb-3">
                        üö∂‚Äç‚ôÇÔ∏è {{convertDistance distance}} from stadium
                    </p>
                    {{/if}}
                    
                    <!-- Transactions -->
                    {{#if transactions}}
                    <div class="mt-auto mb-3">
                        <small class="text-muted">
                            <strong>Services:</strong> {{#each transactions}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}
                        </small>
                    </div>
                    {{/if}}
                    
                    <!-- Actions -->
                    <div class="mt-auto">
                        {{#if url}}
                        <a href="{{url}}" target="_blank" class="btn btn-custom btn-sm w-100">
                            View on Yelp
                        </a>
                        {{/if}}
                    </div>
                </div>
            </div>
        </div>
        {{else}}
        <div class="col-12">
            <div class="card custom-card">
                <div class="card-body text-center py-5">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">üçΩÔ∏è</div>
                    <h4>No restaurants found</h4>
                    <p class="text-muted mb-4">Try adjusting your search criteria or check back later for updates.</p>
                    <a href="/" class="btn btn-custom">New Search</a>
                </div>
            </div>
        </div>
        {{/each}}
    </div>

    <!-- Pagination -->
    {{#if totalPages}}
    <div class="d-flex justify-content-center mt-4"></div>
        <nav style="overflow-x:auto;">
            <ul id="pagination" class="pagination flex-nowrap">

                {{!-- Previous --}}
                <li class="page-item {{#if (eq currentPage 1)}}disabled{{/if}}">
                    <a class="page-link"
                       href="?page={{subtract currentPage 1}}
                       &limit={{limit}}
                       &category={{selectedCategory}}
                       &sort={{selectedSort}}
                       &league={{league}}
                       &team={{team}}
                       &stadium={{stadium}}">
                        Previous
                    </a>
                </li>

                {{!-- Page Numbers --}}
                {{#each (range 1 totalPages)}}
                    <li class="page-item {{#if (eq ../currentPage this)}}active{{/if}}">
                    <a class="page-link"
                       href="?page={{this}}
                       &limit={{../limit}}
                       &category={{../selectedCategory}}
                       &sort={{../selectedSort}}
                       &league={{../league}}
                       &team={{../team}}
                       &stadium={{../stadium}}">
                        {{this}}
                    </a>
                    </li>
                {{/each}}

                {{!-- Next --}}
                <li class="page-item {{#if (eq currentPage totalPages)}}disabled{{/if}}">
                    <a class="page-link"
                       href="?page={{add currentPage 1}}
                       &limit={{limit}}
                       &category={{selectedCategory}}
                       &sort={{selectedSort}}
                       &league={{league}}
                       &team={{team}}
                       &stadium={{stadium}}">
                        Next
                    </a>
                </li>
            </ul>
        </nav>
    </div>
    {{/if}}

</div>

{{> footer}}
