{{> header}}

<div class="container">
  <h2>Select Stadium</h2>
  
  <select id="stadium-select" class="form-control">
    {{#each stadiums}}
        <option value="{{this._id}}">
            {{this.team}} – {{this.stadium}}
        </option>
    {{/each}}
  </select>
  
  <br>
  
  <div>
    <h3>Filters</h3>

    <label>City:</label>
    <select id="filter-city" class="form-control">
      <option value="">All Cities</option>
      {{#each cities}}
        <option value="{{this}}">{{this}}</option>
      {{/each}}
    </select>
    
    <label>Category:</label>
    <select id="filter-category" class="form-control">
      <option value="">All Categories</option>
      {{#each categories}}
        <option value="{{this}}">{{this}}</option>
      {{/each}}
    </select>

    <br>
    <button onclick="loadBusinesses()" class="btn btn-primary">Load Businesses</button>
  
  </div>
  
  <hr>
  
  <h3>Restaurants</h3>
  <ul id="business-list"></ul>
  <div id="pagination-controls"></div>
</div>

<script>
async function loadBusinesses(page = 1) {
  const stadiumId = document.getElementById("stadium-select").value;
  const city = document.getElementById("filter-city").value;
  const category = document.getElementById("filter-category").value;

  const params = new URLSearchParams({ page, limit: 10, city, category });

  const res = await fetch(`/api/stadiums/${stadiumId}/restaurants?` + params);
  const data = await res.json();

  const list = document.getElementById("business-list");
  list.innerHTML = "";

  data.businesses.forEach(b => {
    const li = document.createElement("li");
    li.innerHTML = `<strong>${b.name}</strong> – ${b.location.city}`;
    list.appendChild(li);
  });

  // --- Pagination ---
  const pagination = document.getElementById("pagination-controls");
  pagination.innerHTML = "";

  const totalPages = Math.ceil(data.total / data.limit);

  for (let i = 1; i <= totalPages; i++) {
    const btn = document.createElement("button");
    btn.innerText = i;
    btn.className = "btn btn-sm btn-secondary m-1";
    btn.onclick = () => loadBusinesses(i);
    pagination.appendChild(btn);
  }
}
</script>
